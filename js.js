
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////// DIBUIXAR
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////////////////////////////CANVAS
const canvas = document.getElementById("canvas")
canvas.height = window.innerHeight
canvas.width = window.innerWidth
const ctx = canvas.getContext("2d")
ctx.fillStyle = "#808080"; 
ctx.fillRect(0, 0, canvas.width, canvas.height);

//linia
ctx.strokeStyle = "#FFFFFF"; 
ctx.fillStyle = "#FFFFFF";
ctx.brushWidth = 40

/////////////////////////////////////////////////////////////////////////////////////////////VARIABLES
//posicions anterior ratolí
let prevX = null
let prevY = null

//pintant?
let painting = false; 

/////////////////////////////////////////////////////////////////////////////////////////////FUNCIONS
//e = event per després posar-ho tot en els events listeners
//començar a pinta
const  startPainting=(e)=> {
    painting = true;
    if(e.type === "touchstart") {
        prevX = e.touches[0].clientX;
        prevY = e.touches[0].clientY;
    } else {
        prevX = e.clientX;
        prevY = e.clientY;
    }
}

//acabar de pintar
const stopPainting = (e) => {
    painting = false;
    prevX = null;
    prevY = null;
}



//pintar
const draw = (e) => {
    if (!painting) return; // si no está pintant adeu.

    let currentX, currentY;

    if (e.type === "touchmove") {
        currentX = e.touches[0].clientX;
        currentY = e.touches[0].clientY;
    } else {
        currentX = e.clientX;
        currentY = e.clientY;
    }

    ctx.beginPath();

    // 1. dibuix un cecle per cada punt
    ctx.arc(currentX, currentY, ctx.brushWidth / 2, 0, Math.PI * 2);
    ctx.fill();
    // 2. dibuixar una línia entre els dos punts
    ctx.beginPath();
    ctx.moveTo(prevX, prevY);
    ctx.lineWidth = ctx.brushWidth;
    ctx.lineTo(currentX, currentY);
    ctx.stroke();
    // la combinació de 1 i 2 fa que la línia sigui més suau.

    prevX = currentX;
    prevY = currentY;
};

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////EVENTS
//funció per afegir múltiples event listeners
const  addMultipleListeners=(element, events, handler)=> {
    events.forEach(event => {
        element.addEventListener(event, handler);
    });
}

//afegir event listeners
addMultipleListeners(window, ["mousedown", "touchstart"], startPainting);
addMultipleListeners(window, ["mouseup", "touchend"], stopPainting);
addMultipleListeners(window, ["mousemove", "touchmove"], draw);


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////SALVAR EL DIBUIX
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

const saveButton = document.getElementById('saveButton');

const saveImage = () => {
        let dataURL = canvas.toDataURL('image/png');
        let a = document.createElement('a');
        a.href = dataURL;
        a.download = 'seeeeeehhh.png';
        a.click();
}

saveButton.addEventListener('click',saveImage);